name: Trigger Private Workflow

on:
    workflow_dispatch:
    push:
      branches: [ 'main' ]
      # Only runs AFTER PR is merged by trusted maintainer
    # SECURITY NOTES:
    # - pull_request: SAFE - forks cannot access secrets
    # - pull_request_target: DANGEROUS - has access to secrets!
    # - push: SAFE if you review PRs before merging
    # - workflow_dispatch: SAFE - requires manual approval

permissions:
  contents: read

jobs:
  trigger-private:
    runs-on: ubuntu-latest
    steps:
      - name: List available workflows
        run: |
          echo "Checking available workflows in private repo..."
          curl -s \
            -H "Authorization: token ${{ secrets.PRIVATE_REPO_PAT }}" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/Aidans-test-org/test-repo4-private-testing/actions/workflows | jq '.workflows[] | {id, name, path}'

      - name: Trigger workflow in private repo
        run: |
          workflow_file="clone-test-repo2-private.yml"
          
          curl -X POST \
            -H "Authorization: token ${{ secrets.PRIVATE_REPO_PAT }}" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/Aidans-test-org/test-repo4-private-testing/actions/workflows/${workflow_file}/dispatches \
            -d '{"ref":"main"}'
